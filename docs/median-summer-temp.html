<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 2 Median Summer Temperature | Indicators for Ecosystem Condition in Norway</title>
<meta name="author" content="Anders L. Kolstad">
<meta name="description" content="Author and date: Anders L. Kolstad March 2023  Ecosystem Økologisk.egenskap ECT.class All Abiotiske egenskaper Physical state characteristics   2.1 Introduction This chapters describes the...">
<meta name="generator" content="bookdown 0.33 with bs4_book()">
<meta property="og:title" content="Chapter 2 Median Summer Temperature | Indicators for Ecosystem Condition in Norway">
<meta property="og:type" content="book">
<meta property="og:url" content="https://ninanor.github.io/ecosystemCondition/index.html/median-summer-temp.html">
<meta property="og:image" content="https://ninanor.github.io/ecosystemCondition/index.html/images/Picture1.png">
<meta property="og:description" content="Author and date: Anders L. Kolstad March 2023  Ecosystem Økologisk.egenskap ECT.class All Abiotiske egenskaper Physical state characteristics   2.1 Introduction This chapters describes the...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 2 Median Summer Temperature | Indicators for Ecosystem Condition in Norway">
<meta name="twitter:description" content="Author and date: Anders L. Kolstad March 2023  Ecosystem Økologisk.egenskap ECT.class All Abiotiske egenskaper Physical state characteristics   2.1 Introduction This chapters describes the...">
<meta name="twitter:image" content="https://ninanor.github.io/ecosystemCondition/index.html/images/Picture1.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.27/datatables.js"></script><link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Indicators for Ecosystem Condition in Norway</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About </a></li>
<li><a class="" href="overview-of-indicators.html">Overview of indicators</a></li>
<li class="book-part">INDICATORS</li>
<li><a class="" href="slitasje-og-kj%C3%B8respor.html"><span class="header-section-number">1</span> Slitasje og kjørespor</a></li>
<li><a class="active" href="median-summer-temp.html"><span class="header-section-number">2</span> Median Summer Temperature</a></li>
<li><a class="" href="alien-species.html"><span class="header-section-number">3</span> Alien species</a></li>
<li><a class="" href="Functional-plant-indicators-wetland.html"><span class="header-section-number">4</span> Functional plant indicators, wetland ecosystems (Moisture, Light, pH, Nitrogen)</a></li>
<li class="book-part">INDICATORS FROM THE ALPINE ASSESSMENT</li>
<li><a class="" href="areal-av-isbreer.html"><span class="header-section-number">5</span> Areal av isbreer</a></li>
<li class="book-part">DEPRECATED</li>
<li><a class="" href="areal-uten-d%C3%B8d-eller-skadet-r%C3%B8sslyng-i-kystlynghei.html"><span class="header-section-number">6</span> Areal uten død eller skadet røsslyng i kystlynghei</a></li>
<li class="book-part">GENERAL TOPICS</li>
<li><a class="" href="naturtype.html"><span class="header-section-number">7</span> Nature types</a></li>
<li><a class="" href="scaling-functions.html"><span class="header-section-number">8</span> Scaling functions</a></li>
<li><a class="" href="homogeneous-impact-areas.html"><span class="header-section-number">9</span> Homogeneous Impact Areas</a></li>
<li><a class="" href="master-grid.html"><span class="header-section-number">10</span> Master grid</a></li>
<li><a class="" href="climate-indicators-explained.html"><span class="header-section-number">11</span> Climate indicators explained</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/NINAnor/ecosystemCondition">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="median-summer-temp" class="section level1" number="2">
<h1>
<span class="header-section-number">2</span> Median Summer Temperature<a class="anchor" aria-label="anchor" href="#median-summer-temp"><i class="fas fa-link"></i></a>
</h1>
<p><br></p>
<p><em>Author and date:</em></p>
<p>Anders L. Kolstad</p>
<p>March 2023</p>
<p><br></p>
<!-- Load all you dependencies here -->
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">Ecosystem</th>
<th align="left">Økologisk.egenskap</th>
<th align="left">ECT.class</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">All</td>
<td align="left">Abiotiske egenskaper</td>
<td align="left">Physical state characteristics</td>
</tr></tbody>
</table></div>
<p><br><br></p>
<hr>
<div id="introduction-1" class="section level2" number="2.1">
<h2>
<span class="header-section-number">2.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-1"><i class="fas fa-link"></i></a>
</h2>
<p>This chapters describes the workflow for an indicator describing the median summer temperature. For a more comprehensive documentation on the development of the workflow itself, see <a href="climate-indicators-explained.html#climate-indicators-explained">here</a>. The data comes from interpolated climate surfaces from <a href="https://senorge.no/">SeNorge</a> which contain one 1x1km raster for each day since 1957 to present. The reference levels are extracted from the time period 1961-1990 (a temporal reference condition).</p>
<p><strong>Workflow</strong></p>
<ol style="list-style-type: decimal">
<li><p>Collate variable data series, ending up with one raster per year after aggregating across days within a year</p></li>
<li><p>Calculate spatially explicit reference values by aggregating across the years 1961-1990. The upper reference value is equal to the median value of this period, and the lower reference values (two-sided) is equal to 5 SD units. The indicator value is the mean over a five year period.</p></li>
<li><p>Calculate indicator values through spatially explicit rescaling based on the reference values</p></li>
<li><p>Mask by ecosystem type (<em>This step is not yet done as we do not have ready available ecosystem maps</em>)</p></li>
<li><p>Aggregate in space (to accounting areas) and take the mean over a five year period to get final indicator values</p></li>
<li><p>Make trend figure and spatially aggregated maps</p></li>
</ol>
</div>
<div id="about-the-underlying-data-1" class="section level2" number="2.2">
<h2>
<span class="header-section-number">2.2</span> About the underlying data<a class="anchor" aria-label="anchor" href="#about-the-underlying-data-1"><i class="fas fa-link"></i></a>
</h2>
<p>The data is in a raster format and extends back to 1957 in the form of multiple interpolated climate variables. The spatial resolution is 1 x 1 km.</p>
<div id="representativity-in-time-and-space-1" class="section level3" number="2.2.1">
<h3>
<span class="header-section-number">2.2.1</span> Representativity in time and space<a class="anchor" aria-label="anchor" href="#representativity-in-time-and-space-1"><i class="fas fa-link"></i></a>
</h3>
<p>The data includes the last normal period (1961-1990) which defines the reference condition for climate variables. Therefore the temporal resolution is very good. Also considering the daily resolution of the data.</p>
<p>Spatially, a 1x1 km resolution is sufficient for most climate variables, esp. in homogeneous terrain, but this needs to be evaluation for each variable and scenario specifically.</p>
</div>
<div id="original-units-1" class="section level3" number="2.2.2">
<h3>
<span class="header-section-number">2.2.2</span> Original units<a class="anchor" aria-label="anchor" href="#original-units-1"><i class="fas fa-link"></i></a>
</h3>
<p>Varied. Specified below for each parameter.</p>
</div>
<div id="temporal-coverage-1" class="section level3" number="2.2.3">
<h3>
<span class="header-section-number">2.2.3</span> Temporal coverage<a class="anchor" aria-label="anchor" href="#temporal-coverage-1"><i class="fas fa-link"></i></a>
</h3>
<p>1957 - present</p>
</div>
<div id="additional-comments-about-the-data-set" class="section level3" number="2.2.4">
<h3>
<span class="header-section-number">2.2.4</span> Additional comments about the data set<a class="anchor" aria-label="anchor" href="#additional-comments-about-the-data-set"><i class="fas fa-link"></i></a>
</h3>
<p>The data format has recently changed from .BIL to .nc (netcdf) and now a single file contains all the rasters for one year (365 days), and sometimes for multiple variables also.</p>
</div>
</div>
<div id="ecosystem-characteristic-1" class="section level2" number="2.3">
<h2>
<span class="header-section-number">2.3</span> Ecosystem characteristic<a class="anchor" aria-label="anchor" href="#ecosystem-characteristic-1"><i class="fas fa-link"></i></a>
</h2>
<div id="norwegian-standard" class="section level3" number="2.3.1">
<h3>
<span class="header-section-number">2.3.1</span> Norwegian standard<a class="anchor" aria-label="anchor" href="#norwegian-standard"><i class="fas fa-link"></i></a>
</h3>
<p>These variables typically will fall under the <em>abiotiske egenskaper</em> class.</p>
</div>
<div id="seea-ea" class="section level3" number="2.3.2">
<h3>
<span class="header-section-number">2.3.2</span> SEEA EA<a class="anchor" aria-label="anchor" href="#seea-ea"><i class="fas fa-link"></i></a>
</h3>
<p>In SEEA EA, these variables will typically fall under A1 - Physical state characteristics.</p>
</div>
</div>
<div id="collinearities-with-other-indicators-1" class="section level2" number="2.4">
<h2>
<span class="header-section-number">2.4</span> Collinearities with other indicators<a class="anchor" aria-label="anchor" href="#collinearities-with-other-indicators-1"><i class="fas fa-link"></i></a>
</h2>
<p>Climate variables are most likely to be correlated with each other (e.g. temperature and snow). Also, some climate variables are better classed as pressure indicators, and these might have a causal association with several condition indicators.</p>
</div>
<div id="reference-condition-and-values-1" class="section level2" number="2.5">
<h2>
<span class="header-section-number">2.5</span> Reference condition and values<a class="anchor" aria-label="anchor" href="#reference-condition-and-values-1"><i class="fas fa-link"></i></a>
</h2>
<div id="reference-condition-1" class="section level3" number="2.5.1">
<h3>
<span class="header-section-number">2.5.1</span> Reference condition<a class="anchor" aria-label="anchor" href="#reference-condition-1"><i class="fas fa-link"></i></a>
</h3>
<p>The reference condition for climate variables is defined as the normal period 1961-1990.</p>
</div>
<div id="reference-values-thresholds-for-defining-good-ecological-condition-minimum-andor-maximum-values-1" class="section level3" number="2.5.2">
<h3>
<span class="header-section-number">2.5.2</span> Reference values, thresholds for defining <em>good ecological condition</em>, minimum and/or maximum values<a class="anchor" aria-label="anchor" href="#reference-values-thresholds-for-defining-good-ecological-condition-minimum-andor-maximum-values-1"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li><p>Un-scaled indicator value = median value over 5 year periods (5 years being a pragmatic choice. It is long enough to smooth out a lot of inter-annual variation, and it’s long enough to enable estimating errors)</p></li>
<li><p>Upper reference level (best possible condition) = median value from the reference period</p></li>
<li><p>Thresholds for good ecosystem condition = 2 standard deviation units away from the upper reference level for the climate variable during the reference period.</p></li>
<li><p>Lower reference values (two-directional) = 5 standard deviation units for the climate variable during the reference period (implies linear scaling).</p></li>
</ul>
<p>The choice to use 2 SD units as the threshold values is a subjective choice in many ways, and not founded in any empirical or known relationship between the indicators and ecosystem integrity. The value comes from the common practice of calling something <em>extreme weather</em> when it is outside 2 SD units of the current running average. So, if the indicator value today is &lt;0.6 it implies that the mean for that variable over the last year would have been referred to as <em>extreme</em> if it had occurred between 1961 and 1990. This is I think a conservative threshold, since one would/could call it <em>extreme</em> if only one year is outside the 2SD range, and having the mean of 5 years being outside this range is <em>really</em> extreme.</p>
</div>
</div>
<div id="uncertainties-1" class="section level2" number="2.6">
<h2>
<span class="header-section-number">2.6</span> Uncertainties<a class="anchor" aria-label="anchor" href="#uncertainties-1"><i class="fas fa-link"></i></a>
</h2>
<p>For the indicator map (1 x 1 km raster) there is no uncertainty associated with the indicator values. For aggregated indicator values (e.g. for regions), the uncertainty in the indicator value is calculated from the spatial variation in the indicator values via bootstrapping. This might, however, be changed later to the temporal variation between the five years of each period.</p>
</div>
<div id="references-1" class="section level2" number="2.7">
<h2>
<span class="header-section-number">2.7</span> References<a class="anchor" aria-label="anchor" href="#references-1"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://senorge.no/" class="uri">https://senorge.no/</a></p>
<p><em>rr and tm are being download from:</em> <a href="https://thredds.met.no/thredds/catalog/senorge/seNorge_2018/Archive/catalog.html" class="uri">https://thredds.met.no/thredds/catalog/senorge/seNorge_2018/Archive/catalog.html</a></p>
<div id="additional-resources" class="section level3" number="2.7.1">
<h3>
<span class="header-section-number">2.7.1</span> Additional resources<a class="anchor" aria-label="anchor" href="#additional-resources"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://r-spatial.github.io/stars/">Stars package</a></p>
<p><a href="https://tmieno2.github.io/R-as-GIS-for-Economists/stars-basics.html">R as a GIS for economists</a> chapter 7</p>
<p><hl></hl></p>
</div>
</div>
<div id="analyses-1" class="section level2" number="2.8">
<h2>
<span class="header-section-number">2.8</span> Analyses<a class="anchor" aria-label="anchor" href="#analyses-1"><i class="fas fa-link"></i></a>
</h2>
<div id="data-set" class="section level3" number="2.8.1">
<h3>
<span class="header-section-number">2.8.1</span> Data set<a class="anchor" aria-label="anchor" href="#data-set"><i class="fas fa-link"></i></a>
</h3>
<p>The data is downloaded to a local NINA server, and updated regularly.</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">dir</span> <span class="op">==</span> <span class="st">"C:"</span>, </span>
<span>      <span class="st">"R:/GeoSpatialData/Meteorology/Norway_SeNorge2018_v22.09/Original"</span>,</span>
<span>      <span class="st">"/data/R/GeoSpatialData/Meteorology/Norway_SeNorge2018_v22.09/Original"</span><span class="op">)</span></span></code></pre></div>
<p>This folder contains folder for the different parameters</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "age"        "fsw"        "gwb_eva"    "gwb_gwtcl" </span></span>
<span><span class="co">#&gt;  [5] "gwb_q"      "gwb_sssdev" "gwb_sssrel" "lwc"       </span></span>
<span><span class="co">#&gt;  [9] "qsw"        "rr_tm"      "sd"         "sdfsw"     </span></span>
<span><span class="co">#&gt; [13] "swe"</span></span></code></pre></div>
<p>We are interested in <em>tm</em>, which is temperatur in celcius. For some reason the same variable is called <em>tg</em> in the data itself.</p>
<div id="regions" class="section level4" number="2.8.1.1">
<h4>
<span class="header-section-number">2.8.1.1</span> Regions<a class="anchor" aria-label="anchor" href="#regions"><i class="fas fa-link"></i></a>
</h4>
<p>Importing a shape file with the regional delineation.</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reg</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"data/regions.shp"</span>, options <span class="op">=</span> <span class="st">"ENCODING=UTF8"</span><span class="op">)</span></span>
<span><span class="co">#&gt; options:        ENCODING=UTF8 </span></span>
<span><span class="co">#&gt; Reading layer `regions' from data source </span></span>
<span><span class="co">#&gt;   `/data/scratch/Matt_bookdown__debug/ecosystemCondition/data/regions.shp' </span></span>
<span><span class="co">#&gt;   using driver `ESRI Shapefile'</span></span>
<span><span class="co">#&gt; Simple feature collection with 5 features and 2 fields</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -99551.21 ymin: 6426048 xmax: 1121941 ymax: 7962744</span></span>
<span><span class="co">#&gt; Projected CRS: ETRS89 / UTM zone 33N</span></span>
<span><span class="co">#st_crs(reg)</span></span></code></pre></div>
<p>Outline of Norway</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nor</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"data/outlineOfNorway_EPSG25833.shp"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading layer `outlineOfNorway_EPSG25833' from data source </span></span>
<span><span class="co">#&gt;   `/data/scratch/Matt_bookdown__debug/ecosystemCondition/data/outlineOfNorway_EPSG25833.shp' </span></span>
<span><span class="co">#&gt;   using driver `ESRI Shapefile'</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 2 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -113472.7 ymin: 6448359 xmax: 1114618 ymax: 7939917</span></span>
<span><span class="co">#&gt; Projected CRS: ETRS89 / UTM zone 33N</span></span></code></pre></div>
<p>Remove marine areas from regions</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reg</span> <span class="op">&lt;-</span> <span class="fu">st_intersection</span><span class="op">(</span><span class="va">reg</span>, <span class="va">nor</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">reg</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_polygons</span><span class="op">(</span>col<span class="op">=</span><span class="st">"region"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-8"></span>
<img src="medianSummerTemperature_files/figure-html/unnamed-chunk-8-1.png" alt="Five accounting areas (regions) in Norway." width="672"><p class="caption">
Figure 1.1: Five accounting areas (regions) in Norway.
</p>
</div>
</div>
<div id="ecosystem-map-1" class="section level4" number="2.8.1.2">
<h4>
<span class="header-section-number">2.8.1.2</span> Ecosystem map<a class="anchor" aria-label="anchor" href="#ecosystem-map-1"><i class="fas fa-link"></i></a>
</h4>
<p>Coming soon ….</p>
<p>The climate indicators need to be masked with ecosystem type maps. This step is part of this chapter.</p>
</div>
</div>
<div id="conceptual-workflow" class="section level3" number="2.8.2">
<h3>
<span class="header-section-number">2.8.2</span> Conceptual workflow<a class="anchor" aria-label="anchor" href="#conceptual-workflow"><i class="fas fa-link"></i></a>
</h3>
<p>The general, the conceptual workflow is like this:</p>
<ol style="list-style-type: decimal">
<li>
<p>Collate variable data series</p>
<ul>
<li><p>Import .nc files (loop though year 1961-1990) and subset to the correct attribute</p></li>
<li><p>Filter data by dates (optional) (<code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter</a></code>). <em>This means reading all 365 rasters into memory, and it is much quicker to filter out the correct rasters in the importing step above (see examples later in this chapter)</em></p></li>
<li><p>Aggregate across time within a year (<code><a href="https://r-spatial.github.io/stars/reference/st_apply.html">stars::st_apply</a></code>). <em>This is the most time consuming operation in the workflow.</em></p></li>
<li><p>Join all data into one data cube (<code>stars:c</code>)</p></li>
</ul>
</li>
<li>
<p>Calculate reference values</p>
<ul>
<li><p>Aggregate (<code>st_apply)</code> across reference years (<code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter</a></code>) to get median and sd values</p></li>
<li><p>Join with existing data cube (<code>stars:c</code>)</p></li>
</ul>
</li>
<li>
<p>Calculate indicator values</p>
<ul>
<li>Normalize climate variable at the individual grid cell level using the three reference values (<code>mutate(across()))</code>
</li>
</ul>
</li>
<li><p>Mask by ecosystem type (<em>This could also be done in step one, but it doesn’t speed things up to set some cells to NA</em>)</p></li>
<li>
<p>Aggregate in space (to accounting areas) (<em>zonal statistics</em>)</p>
<ul>
<li><p>Aggregate across 5 year time steps to smooth out random inter-annual variation and leave climate signal</p></li>
<li><p>Intersect with accounting area polygons <code>exactextrar::exact_extract</code> and get mean/median and (spatial) sd. (<em>Alternatively, get temporal sd at the grid cell level in the step above.</em>)</p></li>
</ul>
</li>
<li><p>Make trend figure and spatially aggregated maps</p></li>
</ol>
</div>
<div id="step-1---temporal-aggregation-within-a-year" class="section level3" number="2.8.3">
<h3>
<span class="header-section-number">2.8.3</span> Step 1 - temporal aggregation within a year<a class="anchor" aria-label="anchor" href="#step-1---temporal-aggregation-within-a-year"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">dir</span> <span class="op">==</span> <span class="st">"C:"</span>, </span>
<span>      <span class="st">"R:/"</span>,</span>
<span>      <span class="st">"/data/R/"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">path2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"GeoSpatialData/Meteorology/Norway_SeNorge2018_v22.09/Original/rr_tm/"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">myFiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="va">path2</span>, pattern<span class="op">=</span><span class="st">".nc$"</span>,full.names <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co"># The last file (the last year) is incomplete and don't include all julian dates that we select below, so I will not include it:</span></span>
<span><span class="va">myFiles</span> <span class="op">&lt;-</span> <span class="va">myFiles</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">myFiles</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">real_temp_summer</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="co"># set up parallel cluster using 10 cores</span></span>
<span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu">makeCluster</span><span class="op">(</span><span class="fl">10L</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get julian days after defining months</span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu">stars</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/read_ncdf.html">read_ncdf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">myFiles</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, var<span class="op">=</span><span class="st">"tg"</span><span class="op">)</span></span>
<span><span class="va">start_month_num</span> <span class="op">&lt;-</span>  <span class="fl">6</span></span>
<span><span class="va">end_month_num</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span></span>
<span><span class="va">julian_start</span> <span class="op">&lt;-</span> <span class="fu">yday</span><span class="op">(</span><span class="fu">st_get_dimension_values</span><span class="op">(</span><span class="va">temp</span>, <span class="st">"time"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">%m+%</span></span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">months</a></span><span class="op">(</span><span class="op">+</span><span class="va">start_month_num</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">julian_end</span> <span class="op">&lt;-</span> <span class="fu">yday</span><span class="op">(</span><span class="fu">st_get_dimension_values</span><span class="op">(</span><span class="va">temp</span>, <span class="st">"time"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">%m+%</span></span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">months</a></span><span class="op">(</span><span class="op">+</span><span class="va">end_month_num</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">step</span> <span class="op">&lt;-</span> <span class="va">julian_end</span><span class="op">-</span><span class="va">julian_start</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">myFiles</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu">tic</span><span class="op">(</span><span class="st">"init"</span><span class="op">)</span></span>
<span>  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu">stars</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/read_ncdf.html">read_ncdf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">myFiles</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, var<span class="op">=</span><span class="st">"tg"</span>, proxy<span class="op">=</span><span class="cn">F</span>,</span>
<span>                           ncsub <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="va">julian_start</span><span class="op">)</span>, </span>
<span>                              count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="va">step</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">year_temp</span> <span class="op">&lt;-</span> <span class="fu">year</span><span class="op">(</span><span class="fu">st_get_dimension_values</span><span class="op">(</span><span class="va">temp</span>, <span class="st">"time"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">year_temp</span><span class="op">)</span></span>
<span>  <span class="va">lookup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"v_"</span>, <span class="va">year_temp</span><span class="op">)</span><span class="op">)</span> </span>
<span>    <span class="co"># Perhaps leave out the v_ to get a numeric vector instead, </span></span>
<span>    <span class="co"># which is easier to subset</span></span>
<span>  <span class="fu">st_crs</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">25833</span></span>
<span>  <span class="fu">toc</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">tic</span><span class="op">(</span><span class="st">"filter and st_apply"</span><span class="op">)</span></span>
<span>  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">temp</span> <span class="op">%&gt;%</span></span>
<span>    <span class="co">#filter(time %within% myInterval) %&gt;%</span></span>
<span>    <span class="fu">st_apply</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="va">mean</span>, CLUSTER <span class="op">=</span> <span class="va">cl</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">rename</span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="va">lookup</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="fu">toc</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">tic</span><span class="op">(</span><span class="st">"c()"</span><span class="op">)</span></span>
<span>  <span class="va">real_temp_summer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">real_temp_summer</span><span class="op">)</span></span>
<span>  <span class="co">#rm(temp)</span></span>
<span>  <span class="fu">toc</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">tic</span><span class="op">(</span><span class="st">"Merge"</span><span class="op">)</span></span>
<span><span class="va">real_temp_summer</span> <span class="op">&lt;-</span> <span class="va">real_temp_summer</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="st">"climate_variable"</span><span class="op">)</span></span>
<span><span class="fu">toc</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">stopCluster</span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span></code></pre></div>
<p>This takes about 20 sec per file/year, or 22 min on total. That is not too bad. About 6000 rasters are read into memory. Here’s a test for the effect of splitting over more cores.</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">write_stars</span><span class="op">(</span><span class="va">real_temp_summer</span>, <span class="st">"/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/aggregated_climate_time_series/real_temp_summer.tiff"</span><span class="op">)</span></span></code></pre></div>
<p>Note that GTiff automatically renames the third dimension <em>band</em> and also renames the attribute. I can rename them.</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summer_median_temp</span> <span class="op">&lt;-</span> <span class="va">real_temp_summer</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_set_dimensions</span><span class="op">(</span>names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"v_YEAR"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="st">"temperature"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_stars</span><span class="op">(</span>data <span class="op">=</span> <span class="va">summer_median_temp</span><span class="op">[</span>,,,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">11</span>,<span class="fl">66</span><span class="op">)</span><span class="op">]</span>, downsample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu">scale_x_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">v_YEAR</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-13"></span>
<img src="medianSummerTemperature_files/figure-html/unnamed-chunk-13-1.png" alt="Showing three random slices of the year dimension." width="672"><p class="caption">
Figure 2.1: Showing three random slices of the year dimension.
</p>
</div>
</div>
<div id="step-2---calculate-reference-values" class="section level3" number="2.8.4">
<h3>
<span class="header-section-number">2.8.4</span> Step 2 - calculate reference values<a class="anchor" aria-label="anchor" href="#step-2---calculate-reference-values"><i class="fas fa-link"></i></a>
</h3>
<p>We need to first to define a reference period and then to subset our data <code>summer_median_temp</code>.</p>
<p>First we need to rename our dimension values and turn them back into dates.</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_dims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="fu">st_get_dimension_values</span><span class="op">(</span><span class="va">summer_median_temp</span>, <span class="st">"v_YEAR"</span><span class="op">)</span>, <span class="fl">3</span>, <span class="fl">6</span><span class="op">)</span>, <span class="st">"-01-01"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">summer_median_temp_ref</span> <span class="op">&lt;-</span> <span class="va">summer_median_temp</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">st_set_dimensions</span><span class="op">(</span><span class="st">"v_YEAR"</span>, values <span class="op">=</span> <span class="va">new_dims</span><span class="op">)</span></span></code></pre></div>
<p>Then I can filter to leave only the reference period.</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summer_median_temp_ref</span> <span class="op">&lt;-</span> <span class="va">summer_median_temp_ref</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">v_YEAR</span> <span class="op">%within%</span> <span class="fu">interval</span><span class="op">(</span><span class="st">"1961-01-01"</span>, <span class="st">"1990-12-31"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">st_get_dimension_values</span><span class="op">(</span><span class="va">summer_median_temp_ref</span>, <span class="st">"v_YEAR"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "1990-01-01" "1989-01-01" "1988-01-01" "1987-01-01"</span></span>
<span><span class="co">#&gt;  [5] "1986-01-01" "1985-01-01" "1984-01-01" "1983-01-01"</span></span>
<span><span class="co">#&gt;  [9] "1982-01-01" "1981-01-01" "1980-01-01" "1979-01-01"</span></span>
<span><span class="co">#&gt; [13] "1978-01-01" "1977-01-01" "1976-01-01" "1975-01-01"</span></span>
<span><span class="co">#&gt; [17] "1974-01-01" "1973-01-01" "1972-01-01" "1971-01-01"</span></span>
<span><span class="co">#&gt; [21] "1970-01-01" "1969-01-01" "1968-01-01" "1967-01-01"</span></span>
<span><span class="co">#&gt; [25] "1966-01-01" "1965-01-01" "1964-01-01" "1963-01-01"</span></span>
<span><span class="co">#&gt; [29] "1962-01-01" "1961-01-01"</span></span></code></pre></div>
<p>And then we calculate the median and sd like above</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">median_sd</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu">makeCluster</span><span class="op">(</span><span class="fl">10L</span><span class="op">)</span></span>
<span><span class="va">summer_median_temp_ref</span> <span class="op">&lt;-</span> <span class="va">summer_median_temp_ref</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">st_apply</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, </span>
<span>           FUN <span class="op">=</span>  <span class="va">median_sd</span>,</span>
<span>           CLUSTER <span class="op">=</span> <span class="va">cl</span><span class="op">)</span></span>
<span><span class="fu">stopCluster</span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>user</th>
<th>system</th>
<th>elapsed</th>
</tr></thead>
<tbody><tr class="odd">
<td>9.624</td>
<td>6.069</td>
<td>20.903</td>
</tr></tbody>
</table></div>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">write_stars</span><span class="op">(</span><span class="va">summer_median_temp_ref</span>, <span class="st">"/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/aggregated_climate_time_series/summer_median_temp_ref.tiff"</span><span class="op">)</span></span></code></pre></div>
<p>Pivot and turn dimension into attributes, and rename attributes:</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summer_median_temp_ref_long</span> <span class="op">&lt;-</span> <span class="va">summer_median_temp_ref</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="st">"band"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"reference_upper"</span>, <span class="st">"sd"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tmap_arrange</span><span class="op">(</span></span>
<span><span class="fu">tm_shape</span><span class="op">(</span><span class="fu">st_downsample</span><span class="op">(</span><span class="va">summer_median_temp_ref_long</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_raster</span><span class="op">(</span><span class="st">"reference_upper"</span><span class="op">)</span></span>
<span>,</span>
<span><span class="fu">tm_shape</span><span class="op">(</span><span class="fu">st_downsample</span><span class="op">(</span><span class="va">summer_median_temp_ref_long</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_raster</span><span class="op">(</span><span class="st">"sd"</span>,</span>
<span>            palette <span class="op">=</span> <span class="st">"-viridis"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-21"></span>
<img src="medianSummerTemperature_files/figure-html/unnamed-chunk-21-1.png" alt="Showing the upper reference levels and the standard deviation from actual data of median summer temperatures." width="672"><p class="caption">
Figure 2.2: Showing the upper reference levels and the standard deviation from actual data of median summer temperatures.
</p>
</div>
<p>I need to combine the variables and the ref values in one data cube</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_var</span> <span class="op">&lt;-</span> <span class="va">summer_median_temp</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="st">"v_YEAR"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">summer_median_temp_ref_long</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="step-3---normalise-variable" class="section level3" number="2.8.5">
<h3>
<span class="header-section-number">2.8.5</span> Step 3 - normalise variable<a class="anchor" aria-label="anchor" href="#step-3---normalise-variable"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># select the columns to normalise</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">y_var</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">y_var</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"reference_upper"</span>, <span class="st">"sd"</span><span class="op">)</span> <span class="op">]</span></span>
<span><span class="va">cols_new</span> <span class="op">&lt;-</span> <span class="va">cols</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">cols_new</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"v_"</span>, <span class="st">"i_"</span>, <span class="va">cols</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The break point scaling is actually not needed here, since </span></span>
<span><span class="co"># having the lower ref value to be 5 sd implies that the threshold is</span></span>
<span><span class="co"># 2 sd in a linear scaling.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span></span>
<span><span class="va">y_var_norm</span> <span class="op">&lt;-</span> <span class="va">y_var</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>reference_low <span class="op">=</span> <span class="va">reference_upper</span> <span class="op">-</span> <span class="fl">5</span><span class="op">*</span><span class="va">sd</span> <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>reference_low2 <span class="op">=</span> <span class="va">reference_upper</span> <span class="op">+</span> <span class="fl">5</span><span class="op">*</span><span class="va">sd</span> <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>threshold_low <span class="op">=</span> <span class="va">reference_upper</span> <span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">sd</span> <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>threshold_high <span class="op">=</span> <span class="va">reference_upper</span> <span class="op">+</span><span class="fl">2</span><span class="op">*</span><span class="va">sd</span> <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="va">cols</span><span class="op">)</span>, <span class="op">~</span> </span>
<span>                  <span class="fu">if_else</span><span class="op">(</span><span class="va">.x</span> <span class="op">&lt;</span> <span class="va">reference_upper</span>,</span>
<span>                  <span class="fu">if_else</span><span class="op">(</span><span class="va">.x</span> <span class="op">&lt;</span> <span class="va">threshold_low</span>, </span>
<span>                                        <span class="op">(</span><span class="va">.x</span> <span class="op">-</span> <span class="va">reference_low</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">threshold_low</span> <span class="op">-</span> <span class="va">reference_low</span><span class="op">)</span>,</span>
<span>                                        <span class="op">(</span><span class="va">.x</span> <span class="op">-</span> <span class="va">threshold_low</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">reference_upper</span> <span class="op">-</span> <span class="va">threshold_low</span><span class="op">)</span>,</span>
<span>                                        <span class="op">)</span>,</span>
<span>                  <span class="fu">if_else</span><span class="op">(</span><span class="va">.x</span> <span class="op">&gt;</span> <span class="va">threshold_high</span>, </span>
<span>                                        <span class="op">(</span><span class="va">reference_low2</span> <span class="op">-</span> <span class="va">.x</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">reference_low2</span> <span class="op">-</span> <span class="va">threshold_high</span><span class="op">)</span>,</span>
<span>                                        <span class="op">(</span><span class="va">threshold_high</span> <span class="op">-</span> <span class="va">.x</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">threshold_high</span> <span class="op">-</span> <span class="va">reference_upper</span><span class="op">)</span>,</span>
<span>                                        <span class="op">)</span></span>
<span>                <span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="va">cols</span><span class="op">)</span>, <span class="op">~</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">.x</span> <span class="op">&gt;</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="va">cols</span><span class="op">)</span>, <span class="op">~</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">.x</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="fl">0</span>, <span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rename</span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="va">cols_new</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">select</span><span class="op">(</span><span class="va">y_var</span>, <span class="fu">all_of</span><span class="op">(</span><span class="va">cols</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>user</th>
<th>system</th>
<th>elapsed</th>
</tr></thead>
<tbody><tr class="odd">
<td>14.803</td>
<td>2.717</td>
<td>17.512</td>
</tr></tbody>
</table></div>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/gc.html">gc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">y_var_norm</span>, <span class="st">"/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/aggregated_climate_time_series/summer_median_temp_normalised.RData"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Tiff dont allow for multiple attributes:</span></span>
<span><span class="co">#write_stars(y_var_norm, "/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/aggregated_climate_time_series/summer_median_temp_normalised.tiff")</span></span></code></pre></div>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">lims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">22</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggarrange</span><span class="op">(</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_stars</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">st_downsample</span><span class="op">(</span><span class="va">y_var_norm</span><span class="op">[</span><span class="st">"v_1970"</span><span class="op">]</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"D"</span>,</span>
<span>                       limits <span class="op">=</span> <span class="va">lims</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu">scale_x_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>,</span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_stars</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">st_downsample</span><span class="op">(</span><span class="va">y_var_norm</span><span class="op">[</span><span class="st">"reference_upper"</span><span class="op">]</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"D"</span>,</span>
<span>                       limits <span class="op">=</span> <span class="va">lims</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu">scale_x_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>,</span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_stars</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">st_downsample</span><span class="op">(</span><span class="va">y_var_norm</span><span class="op">[</span><span class="st">"reference_low"</span><span class="op">]</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"D"</span>,</span>
<span>                       limits <span class="op">=</span> <span class="va">lims</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu">scale_x_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>,</span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_stars</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">st_downsample</span><span class="op">(</span><span class="va">y_var_norm</span><span class="op">[</span><span class="st">"reference_low2"</span><span class="op">]</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"D"</span>,</span>
<span>                       limits <span class="op">=</span> <span class="va">lims</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu">scale_x_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>,</span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_stars</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">st_downsample</span><span class="op">(</span><span class="va">y_var_norm</span><span class="op">[</span><span class="st">"i_1970"</span><span class="op">]</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"A"</span>,</span>
<span>                       limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu">scale_x_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>, ncol<span class="op">=</span><span class="fl">2</span>, nrow<span class="op">=</span><span class="fl">3</span>, align <span class="op">=</span> <span class="st">"hv"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-27"></span>
<img src="medianSummerTemperature_files/figure-html/unnamed-chunk-27-1.png" alt="Example showing median summer tempretur in 1970, the upper and lwoer reference temperture, i.e. median and 5 SD units of the temperature between  1961-1990, and finally, the scaled indicator values." width="672"><p class="caption">
Figure 1.10: Example showing median summer tempretur in 1970, the upper and lwoer reference temperture, i.e. median and 5 SD units of the temperature between 1961-1990, and finally, the scaled indicator values.
</p>
</div>
<p>The <em>real</em> indicator values should be means over 5 year periods. Calculating a running mean for all time steps is too time consuming. Therefore, the scaled, regional indicator values will be calculated for distinct time steps. The time series can perhaps still be presented with yearly resolution.</p>
</div>
<div id="step-4---mask-with-ecosystem-delineation-map" class="section level3" number="2.8.6">
<h3>
<span class="header-section-number">2.8.6</span> Step 4 - Mask with ecosystem delineation map<a class="anchor" aria-label="anchor" href="#step-4---mask-with-ecosystem-delineation-map"><i class="fas fa-link"></i></a>
</h3>
<p>This step we simply ignore for now. It should be relatively easy to do, when we have the maps.</p>
</div>
<div id="step-5---make-figures" class="section level3" number="2.8.7">
<h3>
<span class="header-section-number">2.8.7</span> Step 5 - Make figures<a class="anchor" aria-label="anchor" href="#step-5---make-figures"><i class="fas fa-link"></i></a>
</h3>
<p>To plot time series I first need to do a spatial aggregation.</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span></span>
<span><span class="va">regional_means</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="va">y_var_norm</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">exact_extract</span><span class="op">(</span><span class="va">reg</span>, fun <span class="op">=</span> <span class="st">'mean'</span>, append_cols <span class="op">=</span> <span class="st">"region"</span>, progress<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"region"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">y_var_norm</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>user; system; elapsed: 7.603; 3.071; 10.697</p>
<p>I could also get the sd like this, if I wanted to base the indicator uncertainty on a measure of spatial variation:</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span></span>
<span><span class="va">regional_sd</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="va">y_var_norm</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">exact_extract</span><span class="op">(</span><span class="va">reg</span>, fun <span class="op">=</span> <span class="st">'stdev'</span>, append_cols <span class="op">=</span> <span class="st">"region"</span>, progress<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"region"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">y_var_norm</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>user; system; elapsed: 7.420; 2.921; 10.355</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">regional_means</span>, <span class="st">"temp/regional_means.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">regional_sd</span>, <span class="st">"temp/regional_sd.rds"</span><span class="op">)</span></span></code></pre></div>
<p>Reshape and plot</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">div</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"reference_upper"</span>,</span>
<span>         <span class="st">"reference_low"</span>,</span>
<span>         <span class="st">"reference_low2"</span>,</span>
<span>         <span class="st">"threshold_low"</span>,</span>
<span>         <span class="st">"threshold_high"</span>,</span>
<span>         <span class="st">"sd"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">regional_means</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">region</span>, <span class="va">div</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">regional_means_long</span> <span class="op">&lt;-</span> <span class="va">regional_means</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">!</span><span class="fu">all_of</span><span class="op">(</span><span class="va">div</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">!</span><span class="va">region</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">separate</span><span class="op">(</span><span class="va">name</span>, into<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"type"</span>, <span class="st">"year"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span><span class="co">#id_cols = region,</span></span>
<span>              names_from <span class="op">=</span> <span class="va">type</span><span class="op">)</span>  <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">temp</span>, by<span class="op">=</span><span class="fu">join_by</span><span class="op">(</span><span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>diff <span class="op">=</span> <span class="va">v</span><span class="op">-</span><span class="va">reference_upper</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>threshold_low_centered <span class="op">=</span> <span class="va">threshold_low</span><span class="op">-</span><span class="va">reference_upper</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>threshold_high_centered <span class="op">=</span> <span class="va">threshold_high</span><span class="op">-</span><span class="va">reference_upper</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Adding the spatial sd</span></span>
<span><span class="co">#(</span></span>
<span><span class="co">#regional_means_long &lt;- regional_sd %&gt;%</span></span>
<span><span class="co">#  select(!all_of(div)) %&gt;%</span></span>
<span><span class="co">#  pivot_longer(!region) %&gt;%</span></span>
<span><span class="co">#  separate(name, into=c("type", "year")) %&gt;%</span></span>
<span><span class="co">#  pivot_wider(names_from = type) %&gt;%</span></span>
<span><span class="co">#  rename(i_sd = i,</span></span>
<span><span class="co">#         v_sd = v) %&gt;%</span></span>
<span><span class="co">#  left_join(regional_means_long, by=join_by(region, year))</span></span>
<span><span class="co">#)</span></span></code></pre></div>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regOrder</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Østlandet"</span>,<span class="st">"Sørlandet"</span>,<span class="st">"Vestlandet"</span>,<span class="st">"Midt-Norge"</span>,<span class="st">"Nord-Norge"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">regional_means_long</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>col <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">diff</span><span class="op">&gt;</span><span class="fl">0</span>, <span class="st">"1"</span>, <span class="st">"2"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, </span>
<span>           y <span class="op">=</span> <span class="va">diff</span>, fill <span class="op">=</span> <span class="va">col</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">threshold_low_centered</span><span class="op">)</span>,</span>
<span>        linetype<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">threshold_high_centered</span><span class="op">)</span>,</span>
<span>        linetype<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1961</span>, xend<span class="op">=</span><span class="fl">1990</span>,</span>
<span>               y <span class="op">=</span> <span class="fl">0</span>, yend <span class="op">=</span> <span class="fl">0</span>,</span>
<span>               linewidth<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_fill_hue</span><span class="op">(</span>l<span class="op">=</span><span class="fl">70</span>, c<span class="op">=</span><span class="fl">60</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Sommertemperatur\navvik fra 1961-1990"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill<span class="op">=</span><span class="st">"none"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span> <span class="va">.</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">region</span>, levels <span class="op">=</span> <span class="va">regOrder</span><span class="op">)</span>,</span>
<span>              ncol<span class="op">=</span><span class="fl">3</span>,</span>
<span>              scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:summer-temp-time-series"></span>
<img src="medianSummerTemperature_files/figure-html/summer-temp-time-series-1.png" alt="Times series for median summer temperature centered on the median value during the reference period. The reference period is indicated with a thick horizontal line. Dottet horisontal lines are 2 sd units for the reference period." width="672"><p class="caption">
Figure 2.3: Times series for median summer temperature centered on the median value during the reference period. The reference period is indicated with a thick horizontal line. Dottet horisontal lines are 2 sd units for the reference period.
</p>
</div>
<p>Then we can take the mean and sd over the last 5 years and add to a spatial representation.</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span></span>
<span><span class="va">i_aggregatedToPeriods</span> <span class="op">&lt;-</span> <span class="va">regional_means_long</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>period <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="va">year</span> <span class="op">%between%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2018</span>, <span class="fl">2022</span><span class="op">)</span> <span class="op">~</span> <span class="st">"2018-2022"</span>,</span>
<span>    <span class="va">year</span> <span class="op">%between%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2013</span>, <span class="fl">2017</span><span class="op">)</span> <span class="op">~</span> <span class="st">"2013-2017"</span>,</span>
<span>    <span class="va">year</span> <span class="op">%between%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2008</span>, <span class="fl">2012</span><span class="op">)</span> <span class="op">~</span> <span class="st">"2008-2012"</span>,</span>
<span>    <span class="va">year</span> <span class="op">%between%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2003</span>, <span class="fl">2007</span><span class="op">)</span> <span class="op">~</span> <span class="st">"2003-2007"</span>,</span>
<span>    .default <span class="op">=</span> <span class="st">"pre 2003"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>period_rank <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>   <span class="va">period</span> <span class="op">==</span> <span class="st">"2018-2022"</span> <span class="op">~</span> <span class="fl">5</span>,</span>
<span>   <span class="va">period</span> <span class="op">==</span> <span class="st">"2013-2017"</span> <span class="op">~</span> <span class="fl">4</span>,</span>
<span>   <span class="va">period</span> <span class="op">==</span> <span class="st">"2008-2012"</span> <span class="op">~</span> <span class="fl">3</span>,</span>
<span>   <span class="va">period</span> <span class="op">==</span> <span class="st">"2003-2007"</span> <span class="op">~</span> <span class="fl">2</span>,</span>
<span>    .default <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">region</span>, <span class="va">period</span>, <span class="va">period_rank</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>indicator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>,</span>
<span>            sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>            <span class="co"># If I inluded a spatial measure for the uncertainty, here is how I would carry the errors:</span></span>
<span>            <span class="co">#spatial_sd = sqrt(sum(i_sd^2))/length(i_sd)</span></span>
<span>            <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'region', 'period'. You</span></span>
<span><span class="co">#&gt; can override using the `.groups` argument.</span></span>
<span><span class="co">#&gt; # A tibble: 25 × 5</span></span>
<span><span class="co">#&gt; # Groups:   region, period [25]</span></span>
<span><span class="co">#&gt;    region     period    period_rank indicator     sd</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 Midt-Norge 2003-2007           2     0.427 0.139 </span></span>
<span><span class="co">#&gt;  2 Midt-Norge 2008-2012           3     0.573 0.0992</span></span>
<span><span class="co">#&gt;  3 Midt-Norge 2013-2017           4     0.536 0.212 </span></span>
<span><span class="co">#&gt;  4 Midt-Norge 2018-2022           5     0.607 0.179 </span></span>
<span><span class="co">#&gt;  5 Midt-Norge pre 2003            1     0.642 0.182 </span></span>
<span><span class="co">#&gt;  6 Nord-Norge 2003-2007           2     0.460 0.149 </span></span>
<span><span class="co">#&gt;  7 Nord-Norge 2008-2012           3     0.675 0.0602</span></span>
<span><span class="co">#&gt;  8 Nord-Norge 2013-2017           4     0.641 0.127 </span></span>
<span><span class="co">#&gt;  9 Nord-Norge 2018-2022           5     0.625 0.110 </span></span>
<span><span class="co">#&gt; 10 Nord-Norge pre 2003            1     0.625 0.194 </span></span>
<span><span class="co">#&gt; # ℹ 15 more rows</span></span></code></pre></div>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">i_aggregatedToPeriods</span><span class="op">$</span><span class="va">period</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">i_aggregatedToPeriods</span><span class="op">$</span><span class="va">period_rank</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">i_aggregatedToPeriods</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">period_rank</span>, </span>
<span>             y <span class="op">=</span> <span class="va">indicator</span>,</span>
<span>             colour<span class="op">=</span><span class="va">region</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin<span class="op">=</span><span class="va">indicator</span><span class="op">-</span><span class="va">sd</span>, </span>
<span>                    ymax<span class="op">=</span><span class="va">indicator</span><span class="op">+</span><span class="va">sd</span><span class="op">)</span>, </span>
<span>                    width<span class="op">=</span><span class="fl">.2</span>,</span>
<span>                 position<span class="op">=</span><span class="fu">position_dodge</span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>                     labels <span class="op">=</span> <span class="va">labs</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"indikatorverdi"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:summer-temp-time-periods"></span>
<img src="medianSummerTemperature_files/figure-html/summer-temp-time-periods-1.png" alt="Scaled indicator values, aggregated over 5 year intervals. Errors represent temporal variation (standard errors) within regions and across 5 years." width="672"><p class="caption">
Figure 2.4: Scaled indicator values, aggregated over 5 year intervals. Errors represent temporal variation (standard errors) within regions and across 5 years.
</p>
</div>
<p>Finally, I can add these values to the sp object with the accounting areas.</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reg2</span> <span class="op">&lt;-</span> <span class="va">reg</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">i_aggregatedToPeriods</span><span class="op">[</span><span class="va">i_aggregatedToPeriods</span><span class="op">$</span><span class="va">period_rank</span><span class="op">==</span><span class="fl">5</span>,<span class="op">]</span>, by<span class="op">=</span><span class="fu">join_by</span><span class="op">(</span><span class="va">region</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myCol</span> <span class="op">&lt;-</span> <span class="st">"RdYlGn"</span></span>
<span><span class="va">myCol2</span> <span class="op">&lt;-</span> <span class="st">"-RdYlGn"</span></span>
<span></span>
<span><span class="va">tm_main</span> <span class="op">&lt;-</span> <span class="fu">tm_shape</span><span class="op">(</span><span class="va">reg2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_polygons</span><span class="op">(</span>col<span class="op">=</span><span class="st">"indicator"</span>,</span>
<span>              title<span class="op">=</span><span class="st">"Indikator:\nsommertemperatur"</span>,</span>
<span>    palette <span class="op">=</span> <span class="va">myCol</span>,</span>
<span>    style<span class="op">=</span><span class="st">"fixed"</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">.2</span><span class="op">)</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="va">tm_inset</span> <span class="op">&lt;-</span> <span class="fu">tm_shape</span><span class="op">(</span><span class="va">reg2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_polygons</span><span class="op">(</span>col<span class="op">=</span><span class="st">"sd"</span>,</span>
<span>              title<span class="op">=</span><span class="st">"SD"</span>,</span>
<span>              palette <span class="op">=</span> <span class="va">myCol2</span>,</span>
<span>              style<span class="op">=</span><span class="st">"cont"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_layout</span><span class="op">(</span>legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">tmap_arrange</span><span class="op">(</span><span class="va">tm_main</span>, </span>
<span>             <span class="va">tm_inset</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:wall-to-wall-summer-temp-indicator"></span>
<img src="medianSummerTemperature_files/figure-html/wall-to-wall-summer-temp-indicator-1.png" alt="Summer tempreature indicator values for five accounting areas in Norway. SD is the spatial variation." width="672"><p class="caption">
Figure 2.5: Summer tempreature indicator values for five accounting areas in Norway. SD is the spatial variation.
</p>
</div>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="slitasje-og-kj%C3%B8respor.html"><span class="header-section-number">1</span> Slitasje og kjørespor</a></div>
<div class="next"><a href="alien-species.html"><span class="header-section-number">3</span> Alien species</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#median-summer-temp"><span class="header-section-number">2</span> Median Summer Temperature</a></li>
<li><a class="nav-link" href="#introduction-1"><span class="header-section-number">2.1</span> Introduction</a></li>
<li>
<a class="nav-link" href="#about-the-underlying-data-1"><span class="header-section-number">2.2</span> About the underlying data</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#representativity-in-time-and-space-1"><span class="header-section-number">2.2.1</span> Representativity in time and space</a></li>
<li><a class="nav-link" href="#original-units-1"><span class="header-section-number">2.2.2</span> Original units</a></li>
<li><a class="nav-link" href="#temporal-coverage-1"><span class="header-section-number">2.2.3</span> Temporal coverage</a></li>
<li><a class="nav-link" href="#additional-comments-about-the-data-set"><span class="header-section-number">2.2.4</span> Additional comments about the data set</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#ecosystem-characteristic-1"><span class="header-section-number">2.3</span> Ecosystem characteristic</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#norwegian-standard"><span class="header-section-number">2.3.1</span> Norwegian standard</a></li>
<li><a class="nav-link" href="#seea-ea"><span class="header-section-number">2.3.2</span> SEEA EA</a></li>
</ul>
</li>
<li><a class="nav-link" href="#collinearities-with-other-indicators-1"><span class="header-section-number">2.4</span> Collinearities with other indicators</a></li>
<li>
<a class="nav-link" href="#reference-condition-and-values-1"><span class="header-section-number">2.5</span> Reference condition and values</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#reference-condition-1"><span class="header-section-number">2.5.1</span> Reference condition</a></li>
<li><a class="nav-link" href="#reference-values-thresholds-for-defining-good-ecological-condition-minimum-andor-maximum-values-1"><span class="header-section-number">2.5.2</span> Reference values, thresholds for defining good ecological condition, minimum and/or maximum values</a></li>
</ul>
</li>
<li><a class="nav-link" href="#uncertainties-1"><span class="header-section-number">2.6</span> Uncertainties</a></li>
<li>
<a class="nav-link" href="#references-1"><span class="header-section-number">2.7</span> References</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#additional-resources"><span class="header-section-number">2.7.1</span> Additional resources</a></li></ul>
</li>
<li>
<a class="nav-link" href="#analyses-1"><span class="header-section-number">2.8</span> Analyses</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-set"><span class="header-section-number">2.8.1</span> Data set</a></li>
<li><a class="nav-link" href="#conceptual-workflow"><span class="header-section-number">2.8.2</span> Conceptual workflow</a></li>
<li><a class="nav-link" href="#step-1---temporal-aggregation-within-a-year"><span class="header-section-number">2.8.3</span> Step 1 - temporal aggregation within a year</a></li>
<li><a class="nav-link" href="#step-2---calculate-reference-values"><span class="header-section-number">2.8.4</span> Step 2 - calculate reference values</a></li>
<li><a class="nav-link" href="#step-3---normalise-variable"><span class="header-section-number">2.8.5</span> Step 3 - normalise variable</a></li>
<li><a class="nav-link" href="#step-4---mask-with-ecosystem-delineation-map"><span class="header-section-number">2.8.6</span> Step 4 - Mask with ecosystem delineation map</a></li>
<li><a class="nav-link" href="#step-5---make-figures"><span class="header-section-number">2.8.7</span> Step 5 - Make figures</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/NINAnor/ecosystemCondition/blob/master/medianSummerTemperature.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/NINAnor/ecosystemCondition/edit/master/medianSummerTemperature.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Indicators for Ecosystem Condition in Norway</strong>" was written by Anders L. Kolstad. It was last built on 2023-05-29.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
